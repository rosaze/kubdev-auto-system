apiVersion: kubedev.my-project.com/v1alpha1
kind: KubeDevEnvironment
metadata:
  name: demo-nodejs-env
  namespace: kubdev-users
spec:
  userName: "demo-student"

  gitRepository: "https://github.com/vercel/next.js.git"
  gitRef: "canary"

  image: "codercom/code-server:latest"

  # â­ ë¼ì´ë¸ŒëŸ¬ë¦¬ ìë™ ì„¤ì¹˜ ëª…ë ¹
  commands:
    init: |
      echo "========================================="
      echo "ğŸ“¦ Node.js í™˜ê²½ ì„¤ì • ì‹œì‘..."
      echo "========================================="

      cd /workspace

      # Node.js ë²„ì „ í™•ì¸
      echo "âœ… Node.js ë²„ì „:"
      node --version

      # npm ë²„ì „ í™•ì¸
      echo "âœ… npm ë²„ì „:"
      npm --version

      # ê°„ë‹¨í•œ package.json ìƒì„± (ë°ëª¨ìš©)
      echo '{
        "name": "demo-project",
        "version": "1.0.0",
        "description": "KubeDev ë°ëª¨ í”„ë¡œì íŠ¸",
        "main": "index.js",
        "scripts": {
          "start": "node index.js"
        },
        "dependencies": {
          "express": "^4.18.2"
        }
      }' > package.json

      # ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
      echo "ğŸ“š Express.js ì„¤ì¹˜ ì¤‘..."
      npm install

      # ì„¤ì¹˜ í™•ì¸
      echo ""
      echo "âœ… ì„¤ì¹˜ ì™„ë£Œ!"
      echo "-----------------------------------"
      ls -la node_modules | head -10
      echo "-----------------------------------"
      echo ""
      echo "ğŸ‰ í™˜ê²½ ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
      echo "========================================="

    start: ""

  # í¬íŠ¸ ì„¤ì •
  ports:
    - 8080 # code-server
    - 3000 # Express.js ì•±

  # ìŠ¤í† ë¦¬ì§€
  storage:
    size: "10Gi"
